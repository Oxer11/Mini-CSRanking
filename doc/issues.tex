%This file contains the LaTeX code of my laboratory report for my Database course.
%Author: 周芯怡/Xinyi Zhou <17307130354@fudan.edu.cn>
%Author: 张作柏/Zuobai Zhang <17300240035@fudan.edu.cn>

\section{技术难点}

本节主要列举我们在完成项目过程中遇到的问题和技术难点。

\begin{enumerate}
\item {\bf 网站搭建}：我们使用的是Django框架，整个网站的搭建流程如下：首先，我们在urls.py中设置好每个页面的URL网址；然后，创建若干html模板，对应于这些页面；之后，书写后端函数，通过渲染模板完成响应。为了实现各个页面之间的跳转，我们在每个页面中加入超链接，然后在访问某个页面时，通过GET请求将相应的参数传给后端。这里使用GET请求的原因是，参数可以直接在URL中看到，方便调试，也方便直接访问。

\item {\bf 字符编码}：因为在url中显示的字符会进行url编码，前后端交互时如果不进行编码和解码就会出现问题。比如当url参数中带有\&时，就必须在前端的变量后加上|urlencode；前端发送给后端的字符串，有时也需要用urllib.parse.unquote()进行解码。

\item {\bf 分页处理}：像搜索结果、排行榜之类的数据条目较多的页面，需要使用分页技术来控制每页显示的条目数量。这里我们使用的是Django自带的paginate方法，只需要传入相应的参数（进行分割的查询，每个页面的条目个数，当前是第几页）就可以接受当前页面的结果。使用Django提供的接口，这种分页方式可以不需要每次都将所有的结果都返回，而只返回需要显示的结果，大大提升了查询效率。

\item {\bf 局部刷新}：在设计follow功能时，我们在每个学者的主页添加了follow按钮。当用户未登录或未关注该学者时，按钮显示文字为follow；当用户已关注该学者时，按钮显示文字为unfollow。当用户点击follow时会发送请求到后端，为用户添加关注，然后将follow按钮变成unfollow。

这一过程看似简单，但实现起来却相当麻烦。一般而言，点击按钮后，会发送一个GET或POST请求给后端，后端处理后会重新渲染页面，这时网页会自动刷新。然而，整个页面的显示只有follow文字这一处发生了变化，刷新整个页面导致效率低下，使用不便。因此，我们使用了{\bf jquery}的局部更新工具。

我们自行书写了一小段js代码来处理这一操作，大致思路是：首先为follow\_button添加事件响应函数，在follow\_button被点击时触发。接着，我们会获取按钮中文字信息，并将此作为参数，向后端发送POST请求。之后，后端处理该请求，并将相应的返回值以JSON格式传给前端。最后，前端接受后端的响应，并将相应的文字信息写入按钮中。

与之相适应的，后端的代码也需要做相应的调整：当后端接收到请求后，首先判断请求的类型是GET还是POST，若是GET，这说明是常规的请求；若是POST，则说明是点击follow按钮后，jquery发送的请求。若为POST，则首先判断用户是否登录，再根据登录情况对表进行相应修改，最后将需要在按钮中显示的信息返回。

\item {\bf 排行榜显示}：排行榜页面的显示中有三个难点：{\bf 显示/隐藏教师信息}、{\bf 自动勾选领域信息}和{\bf 排行榜的局部刷新}。
\begin{itemize}
\item 访问ranklist页面时，后端会将学校的排名连同该校老师的排名一同返回给前端，而为了不让前端显示的过于冗杂，我们默认会隐藏老师的信息。当用户点击学校旁的三角按钮时，才会显示出该校的老师。这一操作是通过html中display:none的属性完成的。在html中，将一个元素的display属性设置为none后，它将完全隐藏，不占任何位置，这样后端将老师信息传递给前端后，显示任务就全部交给前端了。前端要做的就是利用js，为三角按钮设置事件，当点击该按钮时，切换老师模块的display属性，并更改三角按钮的样式。
\item 自动勾选领域信息是指，为方便用户选择领域，用户可以通过on/off按钮直接勾选/取消勾选某一方向的所有领域。这一功能利用jquery的元素选择器可以简便地完成，添加事件：当点击on时，将相应方向的每个checkbox属性都设置为勾选。
\item 排行榜的局部刷新基本原理与上一条相同。两个不同点是：1.提交POST请求时，需要获取所有checkbox的勾选状况，实现方法是通过jquery获取每个checkbox的情况写入一个数组，之后将数组作为参数传入。2.因为ranklist变化较大，所以后端返回时，需要按照模板将ranklist部分重新渲染一遍，然后在前端通过.html()方法更新该部分的代码。
\end{itemize}

\item {\bf 大数据处理}：因为数据量较大，查询的效率难免会受到限制。处理方式是，允许一些数据的冗余，比如提前计算并维护pub\_cnt这种修改次数较少，但经常被用于查询，且查询效率很低的属性。虽然牺牲了空间，但查询效率大大提升。
\end{enumerate}


